<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/pages/californiatemplate/template.xhtml">

    <ui:define name="head">
        
    </ui:define>

    <ui:define name="content">
        <h:form id="individualGoalsView" enctype="multipart/form-data">
                        <p:growl id="messages" showDetail="true" />


            <div class="p-d-flex p-ai-center p-jc-between p-mb-3 card p-p-3">

                <!-- Left side: Title + Filters -->
                <div class="p-d-flex p-ai-center">


                    <!-- Search Input -->
                    <p:inputText id="searchBox"
                                 placeholder="Search Team Goal"
                                 value="#{individualGoalsView.searchTerm}"
                                 styleClass="p-mr-2">
                        <p:ajax event="keyup"
                                update="individualGoalsView"
                                listener="#{individualGoalsView.reloadFilterReset}" />
                    </p:inputText>

                    <!-- Status Filter -->
                    <p:selectOneMenu value="#{individualGoalsView.search}" styleClass="p-mr-2">
                        <f:selectItem itemLabel="Status" itemValue=""/>
                        <f:selectItem itemLabel="Active" itemValue="ACTIVE"/>
                        <f:selectItem itemLabel="Pending" itemValue="PENDING"/>
                        <f:selectItem itemLabel="Completed" itemValue="COMPLETED"/>
                    </p:selectOneMenu>

                    <!-- Search Button -->
                    <p:commandButton value="Search" icon="pi pi-search"
                                     actionListener="#{individualGoalsView.reloadFilterReset}"/>
                </div>

                <!-- Right side: Add Goal Button -->
                <p:commandButton value="Set Goal" icon="pi pi-plus"
                                 styleClass="add-button"
                                 actionListener="#{individualGoalForm.show}">
                    <p:ajax event="dialogReturn" listener="#{individualGoalsView.showSuccessMessage}" update="individualGoalsView :messages"/>
                    <f:setPropertyActionListener value="#{null}" target="#{individualGoalForm.model}"/>

                    <p:ajax event="dialogReturn" listener="#{individualGoalsView.reloadFilterReset}" update="individualGoalsView"/>
                </p:commandButton>
            </div>

            <!-- Goal Cards -->
            <div class="p-grid p-nogutter p-mt-2" style="background: white">
                <!-- Goals Table -->
                <p:dataTable value="#{individualGoalsView.dataModels}" var="goal"
                             paginator="true" rows="10"
                             paginatorPosition="bottom"
                             styleClass="p-datatable-striped p-datatable-sm"
                             responsiveLayout="scroll">

                    <p:column headerText="Goal Title" >
                        <h:outputText value="#{goal.name}"/>
                    </p:column>

                    <p:column headerText="#{empty goal.departmentGoal.id ? 'Team gGoal' : 'Department goal'}" >
                        <h:outputText value="#{empty goal.departmentGoal.id ? goal.teamGoal.name : goal.departmentGoal.name}"/>
                    </p:column>

                    <p:column headerText="Weight" >
                        <h:outputText value="#{goal.contributionWeight}"/>
                        <h:outputText value="%" />
                    </p:column>

                    <p:column headerText="Created On" >
                        <h:outputText value="#{goal.dateCreated}">
                            <f:convertDateTime pattern="dd MMM yyyy"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Actions" style="width:120px; text-align:center;">
                        <p:commandButton icon="pi pi-eye" title="View"
                                         styleClass="ui-button-info p-button-sm"
                                         action="#{individualGoalDetails.prepareForIndividualGoal(goal.id)}"/>
                        <p:commandButton title="Edit"
                                         icon="pi pi-pencil"
                                         rendered="#{goal.status.toString() ne 'APPROVED'}"
                                         styleClass=" ui-button-info p-button-sm p-mx-2"
                                         actionListener="#{individualGoalForm.show}">
                            <p:ajax event="dialogReturn" listener="#{individualGoalsView.showSuccessMessage}" update="individualGoalsView :messages"/>
                            <f:setPropertyActionListener value="#{goal}" target="#{individualGoalForm.model}"/>

                        </p:commandButton>

                        <p:commandButton title="Delete"
                                         icon="pi pi-trash"
                                         rendered="#{goal.status.name() ne 'APPROVED'}"
                                         styleClass="ui-button-danger p-mr-2"
                                         actionListener="#{individualGoalsView.deleteClient(goal)}"
                                         update="individualGoalsView :messages">
                            <p:confirm header="Confirmation"
                                       message="You are about to delete a goal. Do you wish to continue?"
                                       icon="ui-icon-alert" />
                        </p:commandButton>

                    </p:column>
                </p:dataTable>
            </div>
            <p:confirmDialog global="true">
                <p:commandButton value="Yes" type="button"
                                 ajax="false"
                                 styleClass="ui-confirmdialog-yes" icon="fa fa-thumbs-up" />
                <p:commandButton value="No" type="button"
                                 ajax="false"
                                 styleClass="ui-confirmdialog-no" icon="fa fa-thumbs-down" />
            </p:confirmDialog>
        </h:form>
    </ui:define>
</ui:composition>
