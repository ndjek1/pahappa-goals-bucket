<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pc="http://primefaces.org/california"
                template="/pages/californiatemplate/template.xhtml">

    <ui:define name="head">
        <title>Department Activities</title>
    </ui:define>

    <ui:define name="content">
        <h:form id="departmentActivitiesForm" enctype="multipart/form-data">


            <!-- Filters + Add Activity -->
            <div class="p-d-flex p-jc-between p-ai-center p-mb-3">

                <!-- Left side: Filters -->
                <div class="p-d-flex p-ai-center">

                    <!-- Search Input -->
                    <p:inputText placeholder="Search activities" value="#{departmentActivitiesView.searchTerm}" styleClass="p-mr-2">
                        <p:ajax event="keyup" update="departmentActivitiesTable"
                                listener="#{departmentActivitiesView.reloadFilterReset()}" />
                    </p:inputText>

                    <!-- Status Filter -->
                    <p:selectOneMenu value="#{departmentActivitiesView.selectedStatus}" styleClass="p-mr-2" converter="activityStatusConverter">
                        <f:selectItem itemLabel="All Statuses" itemValue="" />
                        <f:selectItems var="status" itemLabel="#{status.displayName}" itemValue="#{status}" />
                        <p:ajax event="change" update="departmentActivitiesTable"
                                listener="#{departmentActivitiesView.reloadFilterReset()}" />
                    </p:selectOneMenu>


                    <!-- Search Button -->
                    <p:commandButton value="Search" icon="pi pi-search"
                                     actionListener="#{departmentActivitiesView.reloadFilterReset}" styleClass="p-mr-2"/>

                    <!-- Clear Button -->
                    <p:commandButton value="Clear" styleClass="ui-button-outlined ui-button-secondary"
                                     actionListener="#{departmentActivitiesView.clearFilters}" update="departmentActivitiesTable"/>
                </div>

                <!-- Right side: Add Activity Button -->
                <p:commandButton value="Add Activity" icon="pi pi-plus" styleClass="add-button"
                                 actionListener="#{departmentActivityFormDialog.show}">
                    <f:setPropertyActionListener value="#{null}" target="#{departmentActivityFormDialog.model}" />
                    <p:ajax event="dialogReturn" listener="#{departmentActivitiesView.showSuccessMessage}" update="departmentActivitiesForm :messages"/>
                    <p:ajax event="dialogReturn" listener="#{departmentActivitiesView.reloadFilterReset}" update="departmentActivitiesTable"/>
                </p:commandButton>

            </div>
            <!-- Activities List -->
            <div class="card">
                <p:dataTable id="departmentActivitiesTable" var="activity" value="#{departmentActivitiesView.dataModels}"
                             widgetVar="departmentActivitiesTable" paginator="true" lazy="true" rows="20"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                             emptyMessage="#{departmentActivitiesView.dataEmptyMessage}"
                             paginatorPosition="bottom" paginatorAlwaysVisible="false"
                             rowIndexVar="row" reflow="true" styleClass="TableAlgnment">


                    <p:column width="30" headerText="No.">
                        <h:outputText value="#{row + 1}" />
                    </p:column>
                    <p:column headerText="Title">
                        <h:outputText value="#{activity.title}" />
                    </p:column>
                    <p:column headerText="Description">
                        <h:outputText value="#{activity.description}" />
                    </p:column>
                    <p:column headerText="Status">
                        <h:outputText value="#{activity.status}" />
                    </p:column>
                    <p:column headerText="Assigned User">
                        <h:outputText value="#{activity.createdBy != null ? activity.createdBy.fullName : 'N/A'}" />
                    </p:column>
                    <p:column headerText="Created Date">
                        <h:outputText value="#{activity.dateCreated}">
                            <f:convertDateTime pattern="dd MMM, yyyy" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Action" width="120" style="text-align:center"
                    >
                        <p:commandButton title="Update" icon="pi pi-check" styleClass="add-button"
                                         actionListener="#{updateDepartmentActivity.show}">
                            <f:setPropertyActionListener value="#{activity}" target="#{updateDepartmentActivity.model}" />
                            <p:ajax event="dialogReturn" listener="#{departmentActivitiesView.showSuccessMessage}" update="departmentActivitiesForm :messages"/>
                            <p:ajax event="dialogReturn" listener="#{departmentActivitiesView.reloadFilterReset}" update="departmentActivitiesTable"/>
                        </p:commandButton>


                    </p:column>

                </p:dataTable>
            </div>

        </h:form>


    </ui:define>
</ui:composition>
