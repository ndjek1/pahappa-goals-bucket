<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <p:dialog header="KPI Form" widgetVar="kpiForm" modal="true" 
              showEffect="fade" hideEffect="fade" responsive="true" 
              width="700" height="500" closeOnEscape="true"
              styleClass="kpi-form-dialog">
        
        <h:form id="kpiFormDialog">
            <p:growl id="growl" showDetail="true" life="4000" />

            <div class="p-fluid formgrid grid">
                <!-- KPI Name -->
                <div class="field col-12 md:col-6">
                    <label for="kpiName" class="font-bold">KPI Name *</label>
                    <p:inputText id="kpiName" value="#{kpiForm.model != null ? kpiForm.model.name : ''}" 
                                required="true" styleClass="w-full" />
                </div>

                <!-- Measurement Unit -->
                <div class="field col-12 md:col-6">
                    <label for="measurementUnit" class="font-bold">Measurement Unit *</label>
                    <p:selectOneMenu id="measurementUnit" value="#{kpiForm.model != null ? kpiForm.model.measurementUnit : null}" 
                                    required="true" filter="true" filterMatchMode="contains"
                                    styleClass="w-full" noSelectionOption="true">
                        <f:selectItem itemLabel="Select Measurement Unit" itemValue="#{null}" />
                        <f:selectItems value="#{kpiForm.measurementUnits}" var="unit" 
                                      itemLabel="#{unit.displayName}" itemValue="#{unit}" />
                    </p:selectOneMenu>
                </div>

                <!-- Frequency -->
                <div class="field col-12 md:col-6">
                    <label for="frequency" class="font-bold">Frequency *</label>
                    <p:selectOneMenu id="frequency" value="#{kpiForm.model != null ? kpiForm.model.frequency : null}" 
                                    required="true" filter="true" filterMatchMode="contains"
                                    styleClass="w-full" noSelectionOption="true">
                        <f:selectItem itemLabel="Select Frequency" itemValue="#{null}" />
                        <f:selectItems value="#{kpiForm.frequencies}" var="freq" 
                                      itemLabel="#{freq.displayName}" itemValue="#{freq}" />
                    </p:selectOneMenu>
                </div>

                <!-- Target Value -->
                <div class="field col-12 md:col-6">
                    <label for="targetValue" class="font-bold">Target Value *</label>
                    <p:inputNumber id="targetValue" value="#{kpiForm.model != null ? kpiForm.model.targetValue : 0}" 
                                  required="true" minValue="0" decimalPlaces="2"
                                  styleClass="w-full" />
                </div>

                <!-- Current Value -->
                <div class="field col-12 md:col-6">
                    <label for="currentValue" class="font-bold">Current Value</label>
                    <p:inputNumber id="currentValue" value="#{kpiForm.model != null ? kpiForm.model.currentValue : 0}" 
                                  minValue="0" decimalPlaces="2" styleClass="w-full" />
                </div>

                <!-- Start Date -->
                <div class="field col-12 md:col-6">
                    <label for="startDate" class="font-bold">Start Date *</label>
                    <p:calendar id="startDate" value="#{kpiForm.model != null ? kpiForm.model.startDate : null}" 
                               required="true" showTime="false" pattern="MM/dd/yyyy"
                               styleClass="w-full" />
                </div>

                <!-- End Date -->
                <div class="field col-12 md:col-6">
                    <label for="endDate" class="font-bold">End Date (Optional)</label>
                    <p:calendar id="endDate" value="#{kpiForm.model != null ? kpiForm.model.endDate : null}" 
                               showTime="false" pattern="MM/dd/yyyy" styleClass="w-full" />
                </div>

                <!-- Department Goal -->
                <div class="field col-12 md:col-6">
                    <label for="departmentGoal" class="font-bold">Department Goal (Optional)</label>
                    <p:selectOneMenu id="departmentGoal" value="#{kpiForm.model != null ? kpiForm.model.departmentGoal : null}" 
                                    filter="true" filterMatchMode="contains"
                                    styleClass="w-full" noSelectionOption="true">
                        <f:selectItem itemLabel="Select Department Goal" itemValue="#{null}" />
                        <f:selectItems value="#{kpiForm.departmentGoals}" var="deptGoal" 
                                      itemLabel="#{deptGoal.name}" itemValue="#{deptGoal}" />
                    </p:selectOneMenu>
                </div>

                <!-- Team Goal -->
                <div class="field col-12 md:col-6">
                    <label for="teamGoal" class="font-bold">Team Goal (Optional)</label>
                    <p:selectOneMenu id="teamGoal" value="#{kpiForm.model != null ? kpiForm.model.teamGoal : null}" 
                                    filter="true" filterMatchMode="contains"
                                    styleClass="w-full" noSelectionOption="true">
                        <f:selectItem itemLabel="Select Team Goal" itemValue="#{null}" />
                        <f:selectItems value="#{kpiForm.teamGoals}" var="teamGoal" 
                                      itemLabel="#{teamGoal.name}" itemValue="#{teamGoal}" />
                    </p:selectOneMenu>
                </div>

                <!-- Action Buttons -->
                <div class="field col-12">
                    <div class="flex justify-content-end gap-2">
                        <p:commandButton value="Cancel" icon="pi pi-times"
                                         onclick="PF('kpiForm').hide()"
                                         styleClass="p-button-outlined p-button-secondary" />
                        <p:commandButton value="#{kpiForm.edit != null and kpiForm.edit ? 'Update' : 'Save'}" icon="pi pi-check"
                                         process="@form" actionListener="#{kpiForm.persist}"
                                         update="@form growl" styleClass="p-button-primary"
                                         oncomplete="if (!args.validationFailed) PF('kpiForm').hide();" />
                    </div>
                </div>
            </div>
        </h:form>
    </p:dialog>

    <style>
        .kpi-form-dialog .ui-dialog-content {
            padding: 1.5rem;
        }
        .kpi-form-dialog .field {
            margin-bottom: 1rem;
        }
        .kpi-form-dialog label {
            display: block;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        .kpi-form-dialog .p-inputtext,
        .kpi-form-dialog .p-dropdown,
        .kpi-form-dialog .p-calendar {
            width: 100%;
        }
        .kpi-form-dialog .p-button {
            min-width: 100px;
        }
    </style>
</ui:composition>
