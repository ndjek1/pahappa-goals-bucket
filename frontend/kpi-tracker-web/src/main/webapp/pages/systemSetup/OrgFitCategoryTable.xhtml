<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/pages/californiatemplate/template.xhtml">
    <h:outputStylesheet>
        <style>
            .progress-red .ui-progressbar-value {
                background-color: #dc3545 !important; /* red */
            }
            .progress-yellow .ui-progressbar-value {
                background-color: #ffc107 !important; /* yellow */
            }
            .progress-green .ui-progressbar-value {
                background-color: #28a745 !important; /* green */
            }
        </style>

    </h:outputStylesheet>

    <ui:define name="content">
        <div class="card">
            <h:form id="orgFitForm">
                <p:growl id="messages" showDetail="true" life="4000"/>

                <!-- 1. HEADER: Title and Action Buttons -->
                <div class="p-d-flex p-jc-between p-ai-center p-mb-4">
                    <h2 style="margin: 0;">Organisational Fit Categories</h2>
                    <div>
                        <p:commandButton value="Adjust weights"
                                         styleClass="p-button-outlined p-mr-2"
                                         actionListener="..." />

                        <p:commandButton value="Create Category"
                                         icon="pi pi-plus"
                                         styleClass="p-button-success"
                                         actionListener="#{orgFitCategoryForm.show}">
                            <f:setPropertyActionListener value="#{null}" target="#{orgFitCategoryForm.model}" />
                            <p:ajax event="dialogReturn" listener="#{orgFitCategoryView.reloadFilterReset}" update="orgFitForm" />
                        </p:commandButton>
                    </div>
                </div>

                <!-- 2. CONTENT LIST: Using ui:repeat to create custom cards -->
                <p:outputPanel id="categoryListPanel">
                <ui:repeat value="#{orgFitCategoryView.dataModels}" var="category">
                    <div class="p-card p-p-3 p-mb-3" style="border: 1px solid #dee2e6; border-radius: 6px;">

                        <!-- Top part of the card: Name, Description, and Weight -->
                        <div class="p-d-flex p-jc-between p-ai-start">
                            <div>
                                <h4 style="margin-top: 0; margin-bottom: 0.5rem;">#{category.name}</h4>
                                <h:outputText value="#{category.description}" style="color: #6c757d;" />
                            </div>
                            <p:tag value="#{category.weight}%" styleClass="p-mr-2" severity="info" rounded="true" />
                        </div>

                        <hr class="p-my-3"/>

                        <!-- Bottom part of the card: Manage Items and Edit/Delete actions -->
                        <div class="p-d-flex p-jc-between p-ai-center">
                            <p:commandButton value="Manage Items"
                                             styleClass="ui-button-success"
                                             action="#{orgFitCategoryItemView.prepareForCategory(category)}" >
                            </p:commandButton>

                            <div>
                                <p:commandButton value="Edit" icon="pi pi-pencil"
                                                 styleClass=" p-button-text p-mr-2"
                                                 actionListener="#{orgFitCategoryForm.show}">
                                    <f:setPropertyActionListener value="#{category}" target="#{orgFitCategoryForm.model}" />
                                    <p:ajax event="dialogReturn" listener="#{orgFitCategoryView.reloadFilterReset}" update="orgFitForm" />
                                </p:commandButton>

                                <p:commandButton value="Delete" icon="pi pi-trash"
                                                 styleClass="p-button-text ui-button-danger"
                                                 update=":orgFitForm:categoryListPanel :orgFitForm:weightPanel"
                                                 actionListener="#{orgFitCategoryView.deleteClient(category)}">
                                    <p:confirm header="Confirmation"
                                               message="Are you sure you want to delete '#{category.name}'?"
                                               icon="pi pi-exclamation-triangle" />
                                </p:commandButton>
                            </div>
                        </div>
                    </div>
                </ui:repeat>
                </p:outputPanel>
                <!-- Check if the list is empty -->
                <p:outputPanel rendered="#{empty orgFitCategoryView.dataModels}">
                    <div class="p-text-center p-p-4" style="border: 1px dashed #ced4da; border-radius: 6px;">
                        <h:outputText value="No Organisational Fit Categories found." />
                    </div>
                </p:outputPanel>

                <p:outputPanel id="weightPanel">
                    <div class="p-d-flex p-jc-end p-ai-center p-mt-4">
                        <h:outputText value="Total weight" style="font-weight: bold; margin-right: 1rem;" />

                        <p:progressBar value="#{orgFitCategoryView.totalWeight}"
                                       style="width: 300px; height: 14px; margin-right: 1rem;"
                                       styleClass="#{orgFitCategoryView.totalWeight lt 50 ? 'progress-red' :
                             (orgFitCategoryView.totalWeight lt 100 ? 'progress-yellow' : 'progress-green')}" />


                        <h:outputText value="#{orgFitCategoryView.totalWeight}%" style="font-weight: bold;" />
                    </div>
                </p:outputPanel>

                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
                    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" />
                </p:confirmDialog>
            </h:form>
        </div>
    </ui:define>
</ui:composition>