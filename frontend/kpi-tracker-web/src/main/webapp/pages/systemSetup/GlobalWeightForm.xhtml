<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/pages/californiatemplate/dialog-template.xhtml">

    <ui:define name="content">
        <title>Manage Global Weight</title>
        <h:form id="globalWeightDialog" styleClass="ui-fluid formgrid grid"
        rendered="#{globalWeightsForm.activeReviewCycle != null}">

            <p:growl id="growl" showDetail="true" life="4000" />

            <div class="field col-12 p-m-4">
                <h5>Business Cycle</h5>

                <div class="field col-12 " >
                    <p:selectOneMenu value="#{globalWeightsForm.model.reviewCycle}"
                                     converter="reviewCycleConverter" filter="true"
                                     required="true" effect="fold">
                        <f:selectItem itemLabel="Select review cycle" itemValue="#{null}" />
                        <f:selectItems value="#{globalWeightsForm.reviewCycleList}" var="reviewCycle" itemLabel="#{reviewCycle.title}  #{reviewCycle.status.toString()} " itemValue="#{reviewCycle}" />
                    </p:selectOneMenu>


                </div>

            </div>

            <!-- Business Goal Weight -->
            <div class="field col-12 p-mx-4 p-mb-2">
                <h5>Business Goal Weight</h5>
                <p:inputNumber id="mboWeightInput"
                               minValue="0"
                               maxValue="100"
                               decimalPlaces="1"
                             value="#{globalWeightsForm.model.mboWeight}"
                             required="true">
                    <p:ajax event="keyup"
                            listener="#{globalWeightsForm.updateOrgFitWeight}"
                            process="@this"
                            update="orgFitWeightInput" />
                </p:inputNumber>
            </div>

            <!-- Organizational Fit Weight -->
            <div class="field col-12 p-mx-4">
                <h5>Professional Attributes Weight</h5>
                <p:inputNumber id="orgFitWeightInput"
                               minValue="0"
                               maxValue="100"
                               decimalPlaces="1"
                             value="#{globalWeightsForm.model.orgFitWeight}"
                             required="true">
                    <p:ajax event="keyup"
                            listener="#{globalWeightsForm.updateMboWeight}"
                            process="@this"
                            update="mboWeightInput" />
                </p:inputNumber>
            </div>

            <!-- Buttons -->
            <div class="col-12 p-mx-4" style="margin-top: 2rem; display: flex; justify-content: space-between; gap: 1rem;">
                <p:commandButton value="Cancel"
                                 validateClient="false"
                                 process="@this"
                                 action="#{globalWeightsForm.hide}"
                                 styleClass="ui-button-danger p-mx-5"
                                 style="flex: 1;" />

                <p:commandButton value="Save"
                                 rendered="#{globalWeightsForm.model.id eq null}"
                                 process="@form"
                                 actionListener="#{globalWeightsForm.save}"
                                 update="@form growl"
                                 validateClient="true"
                                 style="flex: 1;"
                                 styleClass="ui-button-primary p-mx-5"
                >
                    <f:setPropertyActionListener value="#{true}" target="#{globalWeightView.saved}"/>
                    <f:setPropertyActionListener value="#{false}" target="#{globalWeightView.updated}"/>
                </p:commandButton>
                <p:commandButton value="Update"
                                 rendered="#{globalWeightsForm.model.id ne null}"
                                 process="@form"
                                 actionListener="#{globalWeightsForm.save}"
                                 update="@form growl"
                                 validateClient="true"
                                 style="flex: 1;"
                                 styleClass="ui-button-primary p-mx-5"
                >
                    <f:setPropertyActionListener value="#{false}" target="#{globalWeightView.saved}"/>
                    <f:setPropertyActionListener value="#{true}" target="#{globalWeightView.updated}"/>
                </p:commandButton>
            </div>

        </h:form>
        <!-- Case: Active review cycle is null -->
        <h:panelGroup rendered="#{globalWeightsForm.activeReviewCycle == null}">
            <h:outputText value="No active review cycle available. Please create one first."
                          style="color: red; font-weight: bold; font-size: 1.1em;" />
        </h:panelGroup>
    </ui:define>
</ui:composition>
